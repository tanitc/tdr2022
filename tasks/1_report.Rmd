---
title: "Document"
output: html_document
date: "2022-10-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
suppressPackageStartupMessages(library(tidyverse)) 
library(readxl) 
```

# Introducció

# Processament de dades

## Lectura de les dades

```{r}

if (1==2){
  
  dat<-read_excel("~/e/griu/Crea una carpeta/Dropbox/upf/DISSENY_EXPERIMENT.xlsx",sheet = "Experiment1", range = "C5:P33", col_names = TRUE)
  dat<-read_excel("~/e/griu/Crea una carpeta/Dropbox/upf/DISSENY_EXPERIMENT.xlsx",sheet = "Experiment_COPIA", range = "C5:P33", col_names = TRUE)
  write.table(dat, file="../data/dades.txt", row.names=FALSE, dec=",", sep="\t")
}

td <- read.table("../data/dades.txt", header=TRUE, dec=",", sep="\t")

# columnes de temps

temps_vec <- c("TI","T0","T1","T2","T3","T4")

id_vec <- c("ORDRE","NOM","MEDI","BOSSA","M","B","E")

```

### Validació de la carrega

Es presenta la estructura de les dades.

```{r}
resum <- glimpse(td)

print(resum)
```

Com es pot veure les columnes contenen les diferents observacions d'una mateixa canya dins de una experiment.

Es mostren les primeres files.

```{r}
resum <- head(td)

print(resum)
```

A continuació s'observa quants tipus de canyes i cuantes files té cada tipus.

```{r}
resum <- aggregate(data.frame(N_FILES=rep(1:nrow(td)))
                   ,list(NOM=td$NOM, MEDI=td$MEDI, BOSSA=td$BOSSA, M=td$M, B=td$B)
                   ,sum)
resum <- aggregate(data.frame(N_FILES=rep(1, nrow(td)))
                   ,list(B=td$B, BOSSA=td$BOSSA)
                   ,sum)

print(resum)

```

Com es pot veure, hi ha 7 bosses (B) numerades del 1 a 7 on, en cada bossa tenim una canya diferent (6 en total) i a la setena bossa (anomenada canya de control) que és una bossa de control sense cap canya i serveix per mesurar les posibles variacions de pes de la bossa en el temps.

summary(td)

## Preparació dades

Es calcula les diferencies sobre la bosa buida.

```{r}


for(var in temps_vec) {
  td[[paste0(var,"_DIF")]] <- td[[var]] - td[["TB"]]
}
```


Es valia que les dades son correctes.

```{r}
td %>% select(starts_with("T") ) %>% head()
```



## Reestructuració de les dades

Es reestructura el format de dades transversals on les variables de temps estàn en diferents columnes, a un format de dades longitudinals on cada canya y medi tenen difernets files per cada setmana.

```{r}
p_td  <- td %>% 
  select(all_of(id_vec),all_of(temps_vec)) %>% 
  reshape(direction = "long"
          , idvar = "NOM", v.names = "PES"
          , varying = temps_vec
          , timevar = "SETMANA")
```

Ara el mateix pero amb les diferencies.

```{r}
p_td_dif  <- td %>% 
  select(all_of(id_vec),all_of(paste0(temps_vec,"_DIF"))) %>% 
  reshape(direction = "long"
          , idvar = "NOM", v.names = "PES_DIF"
          , varying = paste0(temps_vec,"_DIF")
          , timevar = "SETMANA")

# s'ajunten les dos

p_td_tot <- merge(p_td,p_td_dif)
```

# Transformació

# passem de c

```{r}
p_td$SETMANA <- p_td$SETMANA - 1
head(p_td,40)
head(p_td_dif,40)

```

